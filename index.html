<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WebApp</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
    body {
        margin: 0;
        padding: 0;
        background: #181818;
        width: 100%;
        height: 100vh;
        overflow: hidden;
        position: relative;
        font-family: sans-serif;
    }

    /* üîµ –í–µ—Ä—Ö–Ω—è—è –ø—Ä–∞–≤–∞—è –∫–Ω–æ–ø–∫–∞ */
    .top-right-btn {
        position: absolute;
        top: 0.7cm;
        right: 0.4cm;
        width: 2.6cm;
        height: 0.7cm;
        background: #d9d9d9;
        border-radius: 14px;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        padding-right: 0.18cm;
        user-select: none;
        gap: 0.12cm;
    }

    .top-right-btn svg {
        width: 0.45cm;
        height: 0.45cm;
    }

    #arrow-icon {
        transition: 0.25s ease;
        transform-origin: center;
        pointer-events: auto;
        cursor: pointer;
    }
    .arrow-rotated {
        transform: rotate(180deg);
    }

    .bottom-bar {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 1.5cm;
        background: #d9d9d9;
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        border-radius: 14px 14px 0 0;
    }

    .nav-btn {
        width: 0.7cm;
        height: 0.7cm;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        position: relative;
        user-select: none;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
    }

    .nav-btn img {
        width: 0.7cm;
        height: 0.7cm;
        object-fit: contain;
        filter: brightness(0);
        pointer-events: none;
    }

    .nav-btn.active::after {
        content: "";
        position: absolute;
        bottom: -0.25cm;
        left: 0;
        width: 100%;
        height: 3px;
        background: #000000;
        border-radius: 2px;
    }

    #inventory-screen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: calc(100vh - 1.5cm);
        background: #181818;
        color: white;
        display: none;
        position: relative;
        overflow: hidden;
    }

    #inventory-empty {
        opacity: 0.7;
        font-size: 20px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        width: 100%;
    }

    #inventory-items {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        justify-content: center;
        margin-top: 20px;
    }

    /* üî≤ –û–∫–Ω–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
    #center-popup {
        position: absolute;
        width: 7cm;
        height: 10cm;
        background: #d9d9d9;
        border-radius: 16px;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: none;
        z-index: 50;
        padding: 10px;
        box-sizing: border-box;
    }

    /* –î–æ–Ω–∞—Ç—ã */
    .donate-item {
        background: white;
        border-radius: 12px;
        padding: 10px;
        text-align: center;
        margin: 10px auto;
        width: 85%;
        box-shadow: 0 0 6px rgba(0,0,0,0.1);
    }
    .donate-item h3 {
        margin: 6px 0;
        font-size: 16px;
    }
    .donate-item button {
        margin-top: 6px;
        background: #000;
        color: #fff;
        border: none;
        padding: 6px 12px;
        border-radius: 10px;
        cursor: pointer;
    }
    .donate-item button:hover {
        background: #333;
    }
</style>
</head>
<body>

<!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ -->
<div id="center-popup">
    <h2 style="text-align:center; color:#000;">–î–æ–Ω–∞—Ç—ã</h2>
    <div class="donate-item">
        <h3>1 –∫–æ–ª–∏–±—Ä–∏ –º–æ–Ω–µ—Ç–∞ ‚Äî 49 Tg Stars</h3>
        <button onclick="buyStars(1)">–ö—É–ø–∏—Ç—å</button>
    </div>
    <div class="donate-item">
        <h3>10 –∫–æ–ª–∏–±—Ä–∏ –º–æ–Ω–µ—Ç ‚Äî 449 Tg Stars</h3>
        <button onclick="buyStars(10)">–ö—É–ø–∏—Ç—å</button>
    </div>
    <div class="donate-item">
        <h3>15 –∫–æ–ª–∏–±—Ä–∏ –º–æ–Ω–µ—Ç ‚Äî 649 Tg Stars</h3>
        <button onclick="buyStars(15)">–ö—É–ø–∏—Ç—å</button>
    </div>
    <div class="donate-item">
        <h3>20 –∫–æ–ª–∏–±—Ä–∏ –º–æ–Ω–µ—Ç ‚Äî 799 Tg Stars</h3>
        <button onclick="buyStars(20)">–ö—É–ø–∏—Ç—å</button>
    </div>
</div>

<!-- üü¶ —ç–∫—Ä–∞–Ω –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è -->
<div id="inventory-screen">
    <div id="inventory-empty">–ù–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤</div>
    <div id="inventory-items"></div>
</div>

<!-- üîµ –í–µ—Ä—Ö–Ω—è—è –º–æ–Ω–µ—Ç–∞ + —Å—Ç—Ä–µ–ª–∫–∞ -->
<div class="top-right-btn" id="top-btn">
    <!-- —Å—Ç—Ä–µ–ª–∫–∞ -->
    <svg id="arrow-icon" xmlns="http://www.w3.org/2000/svg" width="0.4cm" height="0.4cm" viewBox="0 0 64 64" fill="none">
        <path d="M16 24 L32 40 L48 24" stroke="#000000" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>

    <!-- –º–æ–Ω–µ—Ç–∞ -->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
        <defs>
            <radialGradient id="gold" cx="30%" cy="30%" r="80%">
                <stop offset="0%" stop-color="#fff3a0"/>
                <stop offset="40%" stop-color="#f5c454"/>
                <stop offset="75%" stop-color="#d69c1f"/>
                <stop offset="100%" stop-color="#a86f00"/>
            </radialGradient>
        </defs>
        <circle cx="32" cy="32" r="30" fill="url(#gold)" stroke="#a86f00" stroke-width="2"/>
        <circle cx="32" cy="32" r="24" fill="none" stroke="#e0b44d" stroke-width="1.4"/>
        <path d="M18 34 C22 30, 26 28, 31 28 L48 18
                 M31 28 C33 22, 36 18, 41 18
                 C38 23, 38 28, 34 32
                 C32 34, 28 36, 24 36
                 C21 36, 19 35, 18 34
                 M24 36 C22 39, 22 42, 25 44"
              fill="none" stroke="#7a4a00" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round"/>
    </svg>

    <!-- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç -->
    <span id="coinCount" style="margin-left:4px;font-weight:bold;color:#000;">0</span>
</div>

<!-- –Ω–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å -->
<div class="bottom-bar">
    <div class="nav-btn active" id="btn-home" onclick="openHome()">üè†</div>
    <div class="nav-btn" id="btn-calendar" onclick="openCalendar()">üìÖ</div>
    <div class="nav-btn" id="btn-event" onclick="openEvent()">üéâ</div>
    <div class="nav-btn" id="btn-inventory" onclick="openInventory()">üéí</div>
    <div class="nav-btn" id="btn-profile" onclick="openProfile()">üë§</div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

/* === –•–†–ê–ù–ï–ù–ò–ï –ú–û–ù–ï–¢ === */
function getCoins() {
    return parseInt(localStorage.getItem("coins") || "0");
}
function setCoins(value) {
    localStorage.setItem("coins", value);
}
function updateCoinUI() {
    const coinLabel = document.getElementById("coinCount");
    if (coinLabel) coinLabel.textContent = getCoins();
}
updateCoinUI();

/* === –£–ü–†–ê–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–ê–ú–ò === */
function setActive(id) {
    document.querySelectorAll(".nav-btn").forEach(b => b.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}
function hideScreens() {
    document.getElementById("inventory-screen").style.display = "none";
}
function openHome(){ hideScreens(); setActive("btn-home"); }
function openCalendar(){ hideScreens(); setActive("btn-calendar"); }
function openEvent(){ hideScreens(); setActive("btn-event"); }
function openProfile(){ hideScreens(); setActive("btn-profile"); }

/* === –ò–ù–í–ï–ù–¢–ê–†–¨ === */
let inventory = [];

function renderInventory() {
    const emptyText = document.getElementById("inventory-empty");
    const box = document.getElementById("inventory-items");
    box.innerHTML = "";

    if (inventory.length === 0) {
        emptyText.style.display = "block";
        return;
    }
    emptyText.style.display = "none";

    inventory.forEach(item => {
        const el = document.createElement("div");
        el.style.width = "2.2cm";
        el.style.height = "2.2cm";
        el.style.background = "#2a2a2a";
        el.style.borderRadius = "12px";
        el.style.display = "flex";
        el.style.flexDirection = "column";
        el.style.justifyContent = "center";
        el.style.alignItems = "center";
        el.style.color = "white";
        el.innerHTML = `<div style='font-size:28px;'>${item.icon}</div><div style='font-size:12px;margin-top:4px;'>${item.name}</div>`;
        box.appendChild(el);
    });
}
function openInventory() {
    hideScreens(); setActive("btn-inventory");
    document.getElementById("inventory-screen").style.display = "block";
    renderInventory();
}
function addItemFromChest(icon, name) {
    inventory.push({icon, name});
    renderInventory();
}

/* === –°–¢–†–ï–õ–ö–ê –ò –û–ö–ù–û === */
const arrow = document.getElementById("arrow-icon");
const popup = document.getElementById("center-popup");
arrow.addEventListener("click", (e) => {
    e.stopPropagation();
    arrow.classList.toggle("arrow-rotated");
    popup.style.display = arrow.classList.contains("arrow-rotated") ? "block" : "none";
});

/* === Telegram Stars === */
const starProducts = {
    "1": 49,
    "10": 449,
    "15": 649,
    "20": 799
};

function buyStars(amount) {
    const priceStars = starProducts[amount.toString()] * 100;

    const invoice = {
        title: `${amount} –∫–æ–ª–∏–±—Ä–∏ –º–æ–Ω–µ—Ç`,
        description: `–ü–æ–∫—É–ø–∫–∞ ${amount} –∫–æ–ª–∏–±—Ä–∏ –º–æ–Ω–µ—Ç`,
        currency: "XTR",
        prices: [{ label: `${amount} –∫–æ–ª–∏–±—Ä–∏ –º–æ–Ω–µ—Ç`, amount: priceStars }],
        payload: `buy_${amount}`
    };

    tg.openInvoice(invoice, (status) => {
        if (status === "paid") {
            let current = getCoins();
            current += parseInt(amount);
            setCoins(current);
            updateCoinUI();
            alert(`–£—Å–ø–µ—à–Ω–∞—è –ø–æ–∫—É–ø–∫–∞!\n+${amount} –∫–æ–ª–∏–±—Ä–∏ –º–æ–Ω–µ—Ç`);
        }
    });
}
</script>

</body>
</html>
